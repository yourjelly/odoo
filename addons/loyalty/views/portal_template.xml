<odoo>
    <template id="loyalty_buttons" inherit_id="portal.side_content">
        <div id="portal_contact" position="after">
            <div class='o_loyalty_card'>
                <div t-foreach="loyalty_programs" t-as="program"
                    class="portal-loyalty-buttons cursor-pointer">
                    <div t-att-data-card="card.id"
                         t-att-data-program="program"
                         t-foreach="loyalty_programs[program]"
                         t-as="card"
                         class="o_loyalty_button_click d-flex my-2">
                        <span t-attf-class="o_notification_bar rounded-start"
                            style="width: 0.5rem; background-color: var(--cyan)"/>
                        <div
                            class="w-100 py-3 ps-3 pe-5 border border-start-0
                                rounded-end d-flex flex-row gap-3"
                        >
                            <img
                                class="img-fluid"
                                t-att-src="'/loyalty/static/src/img/loyalty.svg'
                                    if program == 'loyalty'
                                    else '/loyalty/static/src/img/ewallet.svg'"
                                width="40"
                            />
                            <div class="d-flex flex-column gap-1">
                                <div>
                                    <strong t-out="card.program_id.display_name"/>
                                </div>
                                <p id="card_points" class="m-0 text-600">
                                    <t t-out="card.points_display"/>
                                </p>
                                <t t-if="any(reward.required_points &lt;= card.points for reward in card.program_id.reward_ids) and program == 'loyalty'">
                                    <p class="m-0 text-info">A reward is waiting for you</p>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="loyalty_card_history_template" name="My Loyalty History">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Loyalty Transaction</t>
            </t>
            <t t-if="not card_history_lines">
                <p class="alert alert-warning">
                    There are currently no transaction lines for this Card.
                </p>
            </t>
            <t t-else="" t-call="portal.portal_table">
                <thead>
                    <tr class="active">
                      <th>Description</th>
                      <th>Order</th>
                      <th>Date</th>
                      <th>Issued</th>
                      <th>Used</th>
                      <th>New Balance</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="card_history_lines" t-as="line">
                      <tr>
                            <td><span t-out="line.description"></span></td>
                            <td t-if="line.order_id">
                                <a t-if="line.order_id._name == 'sale.order'" t-att-href="line.order_id.sudo().get_portal_url()">
                                    <t t-out="line.order_id.display_name"/>
                                </a>
                                <t t-else="">
                                    <t t-out="line.order_id.display_name"/>
                                </t>
                            </td>
                            <td t-else=""></td>
                            <td><span t-out="line.create_date"/></td>
                            <td><span t-out="line.card_id._format_points(line.issued)"/></td>
                            <td><span t-out="line.card_id._format_points(line.used)"/></td>
                            <td><span t-out="line.card_id._format_points(line.new_balance)"/></td>
                        </tr>
                    </t>
                </tbody>
            </t>
        </t>
      </template>
</odoo>
