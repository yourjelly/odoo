<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- TODO ANVFE clean this view (& model, & other onboarding views)
        according to following doc on necessary fields/content
        https://docs.adyen.com/platforms/verification-process/required-information -->

    <record id="adyen_account_view_form" model="ir.ui.view">
        <field name="name">adyen.account.view.form</field>
        <field name="model">adyen.account</field>
        <field name="arch" type="xml">
            <form string="Adyen Account" create="false" js_class="adyen_account_form_view">
                <field name="account_code" invisible="1"/>
                <field name="account_holder_code" invisible="1"/>
                <field name="merchant_status" invisible="1"/>
                <field name="adyen_uuid" invisible="1"/>
                <field name="kyc_tier" invisible="1"/>
                <field name="payout_allowed" invisible="1"/>
                <header>
                    <field name="merchant_status"
                           widget="statusbar"
                           statusbar_visible="pending,active,closed"
                           attrs="{'invisible': [('id', '=', False)]}"/>
                </header>
                <!-- Redirect button to re-submit the account data if the creation failed -->
                <div class="alert alert-danger text-center"
                     name="o_odoo_payments_redirect_button_banner"
                     role="alert"
                     attrs="{'invisible': ['|', ('merchant_status', '!=', 'draft'), ('id', '=', False)]}">
                    Something went wrong when validating your Odoo Payments account. Please validate
                    your account now. <widget name="o_odoo_payments_redirect_button_widget"/>
                </div>
                <!-- The onboarding message giving information on the merchant status and the KYC.
                     The message is not computed if the account status is 'draft' or 'closed'. -->
                <div class="alert alert-warning"
                     attrs="{'invisible': [('onboarding_msg', '=', False)]}"
                     role="status">
                    <a class="close" data-dismiss="alert" href="#" aria-label="Close">
                        <i title="Close" class="small fa fa-times"/>
                    </a>
                    <strong><field name="onboarding_msg"/></strong>
                </div>
                <!-- The message stating that the account is closed -->
                <div class="alert alert-danger"
                     role="alert"
                     attrs="{'invisible': [('merchant_status', '!=', 'closed')]}">
                    <strong><p>Your account is Closed.</p></strong>
                </div>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_show_transactions"
                                type="object"
                                attrs="{'invisible': [('id', '=', False)]}"
                                class="oe_stat_button"
                                icon="fa-credit-card">
                            <!-- NOTE: statbutton shown on purpose even if there are no transactions -->
                            <div class="o_stat_info">
                                <field name="transactions_count" class="o_stat_value"/>
                                <span class="o_stat_text"> Transactions</span>
                            </div>
                        </button>
                        <button
                            name="action_show_payouts"
                            type="object"
                            attrs="{'invisible': [('id', '=', False)]}"
                            class="oe_stat_button"
                            icon="fa-credit-card">
                            <div class="o_stat_info">
                                <field name="payouts_count" class="o_stat_value"/>
                                <span class="o_stat_text"> Payouts</span>
                            </div>
                        </button>
                    </div>
                    <widget name="web_ribbon"
                            title="Test Mode"
                            bg_color="bg-warning"
                            attrs="{'invisible': ['|', ('is_test', '=', False), ('id', '=', False)]}"/>
                    <div class="alert alert-warning"
                         attrs="{'invisible': [('kyc_status_message', '=', False)]}"
                         role="alert">
                        <field name="kyc_status_message" readonly="1"/>
                    </div>
                    <group>
                        <group>
                            <field name="entity_type" attrs="{'readonly': [('id', '!=', False)]}"/>
                        </group>
                        <group>
                            <field name="company_id"
                                   readonly="1"
                                   groups="base.group_multi_company"/>
                        </group>
                        <group string="Individual"
                               attrs="{'invisible': [('entity_type', '!=', 'individual')]}">
                            <field name="first_name"
                                   attrs="{'required': [('entity_type', '=', 'individual')]}"/>
                            <field name="last_name"
                                   attrs="{'required': [('entity_type', '=', 'individual')]}"/>
                            <field name="date_of_birth"
                                   attrs="{'required': [('entity_type', '=', 'individual')]}"/>
                            <field name="document_number"
                                   attrs="{'invisible': [('country_code', 'not in', ['AU', 'CA', 'GR', 'IT', 'US'])],
                                           'required': [('entity_type', '=', 'individual'), ('country_code', 'in', ['AU', 'CA', 'GR', 'IT', 'US'])]}"/>
                            <field name="document_type"
                                   attrs="{'invisible': [('country_code', '!=', 'AU')],
                                           'required': [('entity_type', '=', 'individual'), ('country_code', '=', 'AU')]}"/>
                            <field name="id_type"
                                   attrs="{'invisible': [('id', '=', False)],
                                           'required': [('entity_type', '=', 'individual'), ('kyc_tier', '>', 1)]}"/>
                            <field name="id_front"
                                   filename="id_front_filename"
                                   attrs="{'invisible': [('id', '=', False)],
                                           'required': [('entity_type', '=', 'individual'), ('kyc_tier', '>', 1)]}"/>
                            <field name="id_front_filename" invisible="1"/>
                            <field name="id_back" filename="id_back_filename"
                                attrs="{'invisible': [('id_type', 'not in', ['ID_CARD', 'DRIVING_LICENSE'])],
                                        'required': [('id_type', 'in', ['ID_CARD', 'DRIVING_LICENSE']), ('kyc_tier', '>=', 1)]}"/>
                            <field name="id_back_filename" invisible="1"/>
                        </group>
                        <group string="Business"
                               name="business_details"
                               attrs="{'invisible': [('entity_type', '=', 'individual')]}">
                            <field name="legal_business_name"
                                   attrs="{'required': [('entity_type', '!=', 'individual')]}"/>
                            <field name="doing_business_as"
                                   attrs="{'required': [('entity_type', '!=', 'individual')]}"/>
                            <field name="registration_number"
                                   attrs="{'required': [('entity_type', '!=', 'individual')]}"/>
                        </group>
                        <group string="Contact">
                            <field name="email" widget="email"/>
                            <field name="phone_number"/>
                            <label for="street" string="Address"/>
                            <div class="o_address_format">
                                <field name="street" placeholder="Street" class="o_address_street"/>
                                <field name="house_number_or_name"
                                       placeholder="House number or name"
                                       class="o_address_street"/>
                                <field name="city" placeholder="City" class="o_address_city"/>
                                <field name="state_id"
                                       class="o_address_state"
                                       placeholder="State"
                                       options="{'no_open': True, 'no_quick_create': True}"
                                       attrs="{'required': [('country_code', 'in', ['AU', 'CA', 'IT', 'US'])]}"/>
                                <field name="state_code" invisible="1"/>
                                <field name="zip" placeholder="ZIP" class="o_address_zip"/>
                                <field name="country_id"
                                       placeholder="Country"
                                       class="o_address_country"
                                       options="{'no_open': True, 'no_create': True}"/>
                                <field name="country_code" invisible="1"/>
                            </div>
                        </group>
                        <group string="TEST"
                               groups="base.group_no_one"
                               attrs="{'invisible': [('id', '!=', False)]}">
                            <field name="is_test"
                                   attrs="{'readonly': [('id', '!=', False)]}"/>
                        </group>
                    </group>
                    <notebook attrs="{'invisible': [('id', '=', False)]}">
                        <page string="KYC" attrs="{'invisible': [('transactions_count', '=', 0)]}">
                            <field name="adyen_kyc_ids">
                                <tree no_open="1">
                                    <field name="check_type"/>
<!--                                <field name="document"/>-->
                                    <field name="status"
                                           widget="badge"
                                           decoration-warning="status == 'awaiting_data'"
                                           decoration-info="status == 'pending'"
                                           decoration-success="status in ['data_provided', 'passed']"
                                           decoration-danger="status in ['invalid_data', 'failed', 'retry_limit_reached']"/>
                                    <field name="write_date"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Shareholders"
                              attrs="{'invisible': ['|', ('entity_type', '!=', 'business'), ('transactions_count', '=', 0)],
                                      'required': [('entity_type', '!=', 'individual')]}">
                            <field name="shareholder_ids"
                                   attrs="{'required': [('entity_type', '=', 'business')]}">>
                                <tree>
                                    <field name="first_name"/>
                                    <field name="last_name"/>
                                    <field name="kyc_status"
                                           widget="badge"
                                           attrs="{'invisible': [('kyc_status', '=', False)]}"
                                           decoration-warning="kyc_status == 'awaiting_data'"
                                           decoration-info="kyc_status == 'pending'"
                                           decoration-success="kyc_status in ['data_provided', 'passed']"
                                           decoration-danger="kyc_status == 'failed'"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Manager(s)"
                              attrs="{'invisible': ['|', ('entity_type', '!=', 'nonprofit'), ('transactions_count', '=', 0)]}">
                            <field name="shareholder_ids"
                                   attrs="{'required': [('entity_type', '=', 'nonprofit')]}">
                                <tree>
                                    <field name="first_name"/>
                                    <field name="last_name"/>
                                    <field name="kyc_status"
                                           widget="badge"
                                           attrs="{'invisible': [('kyc_status', '=', False)]}"
                                           decoration-warning="kyc_status == 'awaiting_data'"
                                           decoration-info="kyc_status == 'pending'"
                                           decoration-success="kyc_status in ['data_provided', 'passed']"
                                           decoration-danger="kyc_status == 'failed'"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Bank Accounts">
                            <field name="bank_account_ids">
                                <tree>
                                    <field name="owner_name"/>
                                    <field name="iban"/>
                                    <field name="account_number"/>
                                    <field name="currency_id"/>
                                    <field name="kyc_status"
                                           widget="badge"
                                           attrs="{'invisible': [('kyc_status', '=', False)]}"
                                           decoration-warning="kyc_status == 'awaiting_data'"
                                           decoration-info="kyc_status == 'pending'"
                                           decoration-success="kyc_status in ['data_provided', 'passed']"
                                           decoration-danger="kyc_status == 'failed'"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Payouts"
                              attrs="{'invisible': [('transactions_count', '=', 0)]}">
                            <group>
                                <group>
                                    <field name="payout_schedule"
                                           attrs="{'readonly': [('payout_allowed', '=', False)],
                                                   'invisible': [('id', '=', False)]}"/>
                                </group>
                                <group>
                                    <field name="next_scheduled_payout"
                                           attrs="{'invisible': [('next_scheduled_payout', '=', False)]}"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="action_view_adyen_account" model="ir.actions.act_window">
        <field name="name">Odoo Payments Account</field>
        <field name="res_model">adyen.account</field>
        <field name="view_mode">form</field>
    </record>

</odoo>
